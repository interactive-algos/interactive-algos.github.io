<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Robot Measurement Demo</title>

    <script src='../general/js/utils.js'></script>
    <script src='../general/js/view.js'></script>
    <script src='../general/js/measurement.js'></script>
    <script src='../general/js/particle_filter.js'></script>
    <script src='../general/js/robot.js'></script>
    <script src='../general/js/particle.js'></script>
    <script src='../general/js/map_data.js'></script>
    <script src='../demo/js/measurement_beam_demo.js'></script>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">
    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <style type="text/css">
        canvas {
            border: 1px solid black;
        }
    </style>

    <script>
		var measurementDemo;

		function init()
		{
			measurementDemo = new BeamModelDemo('canvas', getMap(), 3, 0.3, "sensor_model_mini");
		}

		function toggleColoring(event)
		{
			const target = event.target || event.srcElement;
			measurementDemo.setColoring(target.checked);
		}

		function parameterChanged(event)
		{
			const target = event.target || event.srcElement;
			const value = Number(target.value);
			if (target.id === 'nLasers')
			{
				measurementDemo.setNLasers(value + 1);
			} else if (target.id === 'fogOfWar')
			{
				measurementDemo.setSensorRadius(value);
			} else if (target.id === 'sensorNoise')
			{
				measurementDemo.setSensorNoise(value);
			} else if (target.id === 'colorRes')
			{
				measurementDemo.setColoringResolution(value);
			}
		}
    </script>
</head>
<body onload="init();">
<div class="container">
    <div class="row"><h3>Robot Measurement Beam Model</h3></div>

    <div class='row'>
        <div class="col-sm-8">
            <canvas id="canvas" width="700" height="400"></canvas>
        </div>
        <div class="col-sm-4">
            <canvas id="sensor_model_mini" width="175" height="100"></canvas>
            <fieldset>
                <legend>Configuration</legend>
                <table>
                    <tbody>
                    <tr>
                        <td>
                            <label for="nLasers">Number of Lasers</label>:
                        </td>
                        <td>
                            <input id="nLasers" onblur='return parameterChanged(event);'
                                   onkeypress='return isNumber(event);'
                                   class="form-control form-control-sm" value="18" size="4">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="fogOfWar">Sensor Radius</label>:
                        </td>
                        <td>
                            <input id="fogOfWar" onblur='return parameterChanged(event);'
                                   onkeypress='return isNumber(event);'
                                   class="form-control form-control-sm" value="3" size="4">m
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="sensorNoise">Sensor Noise</label>:
                        </td>
                        <td>
                            <input id="sensorNoise" onblur='return parameterChanged(event);'
                                   onkeypress='return isDecimal(event);'
                                   class="form-control form-control-sm" value="0.3" size="4">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="colorRes">Coloring Resolution</label>:
                        </td>
                        <td>
                            <input id="colorRes" onblur='return parameterChanged(event);'
                                   class="form-control form-control-sm" value="10" size="4">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="shouldColor">Color the Map</label>
                        </td>
                        <td>
                            <input id="shouldColor" onchange='return toggleColoring(event);'
                                   type="checkbox">
                        </td>
                    </tr>
                    </tbody>
                </table>

            </fieldset>
        </div>
    </div>
    <span id="probability">status</span>
</div>
</body>
</html>
